<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HealthyPal - New Post</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="/css/main.css"/>
  <link rel="stylesheet" href="/css/newPost.css"/>
</head>
<body>
  
  <!-- Left sidebar -->
  <aside class="sidebar">
    <% if (typeof editing !== 'undefined' && editing) { %>
  <h1>Edit Post</h1>
<% } else { %>
  <h1>Create Post</h1>
<% } %>
    <nav>
      <a href="/main">
        <i class="fa-solid fa-house"></i>
        <span>Home</span>
      </a>
      <a class="active" href="/newPost">
        <i class="fa-solid fa-upload"></i>
        <span>Share</span>
      </a>
      <a href="/bodyInfo">
        <i class="fa-solid fa-chart-line"></i>
        <span>Body Info</span>
      </a>
      
    </nav>
    <a href="/logout" class="logout">
      <i class="fa-solid fa-right-from-bracket"></i>
      <span>Logout</span>
    </a>
  </aside>

  <!-- Right content -->
  <main class="content">
    <section class="card">
      <div class="card-header">
        <i class="fa-solid fa-pen-to-square"></i>
        <div class="card-title"><% if (typeof editing !== 'undefined' && editing) { %>
  Edit Post
<% } else { %>
  Create a New Health Post
<% } %></div>
      </div>

      <!-- Submit to /newPost with multipart/form-data to support image upload -->
      <form class="new-post-form" id="postForm" action="<%= editing ? ('/updatePost/' + post._id) : '/newPost' %>" method="POST" enctype="multipart/form-data">
        
        <!-- Username: optional. If you have auth, fill on server side. -->
        <!-- Image upload: required -->
        <div class="field">
          <label for="image">Image</label>
          <input type="file" id="image" name="image" accept="image/*" />
           <% if (editing && post && post.image) { %>
      <p>Current Image:</p>
      <img src="<%= post.image %>" style="max-width:300px; border-radius:8px; margin-bottom:10px;">
    <% } %>
          <div class="hint">Supports jpg/png/webp/gif. Suggested size ≥ 800×600.</div>
        </div>
        
        <!-- Text content -->
        <div class="field full">
          <label for="caption">What do you want to share?</label>
          <textarea id="caption" name="caption" form="postForm" placeholder="Share your workout, meals, or health insights..." ><%= editing ? post.caption : '' %></textarea>
          <div class="hint">Example: Completed a 5km easy run with a high-protein, low-fat meal plan. Feeling great!</div>
        </div>
        


        <!-- Preview -->
        <div id="preview" class="preview full">
          <img id="previewImg" alt="Preview"/>
          <div class="meta">
            <div id="previewName"></div>
            <div id="previewSize" class="hint"></div>
          </div>
        </div>

        <div class="actions full">
          <button type="button" class="btn btn-secondary" onclick="history.back()">Back</button>
          <button type="submit" class="btn btn-primary">Post</button>
        </div>
      </form>
    </section>
  </main>

  <script>
    // Image preview
    const input = document.getElementById('image');
    const preview = document.getElementById('preview');
    const previewImg = document.getElementById('previewImg');
    const previewName = document.getElementById('previewName');
    const previewSize = document.getElementById('previewSize');

    input.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) {
        preview.style.display = 'none';
        return;
      }
      const url = URL.createObjectURL(file);
      previewImg.src = url;
      previewName.textContent = file.name;
      previewSize.textContent = (file.size / 1024).toFixed(1) + ' KB';
      preview.style.display = 'flex';
    });
  </script>
</body>
</html>
